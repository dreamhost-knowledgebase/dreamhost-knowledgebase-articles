<p>Using a simple shell script, you can automate website and database backups to DreamObjects. This script does the following:</p>
<ul>
<li>dumps a database in the format "mm-dd-yyyy_db-name_.sql" to the directory "/home/username/backup/example.com”</li>
<li>uploads the database to your DreamObjects bucket</li>
<li>zips your website directory in the format of "mm-dd-yyyy_example.com.zip" to the directory "/home/username/backup/example.com”</li>
<li>uploads the website .zip file to DreamObjects</li>
<li>deletes the database and website zip file on the web server to conserve space</li>
</ul>
<h2>Step 1 — Setting up your DreamObjects bucket</h2>
<ol>
<li>View the following article to create a DreamObjects account, add a user, and create a bucket.
<ul>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214823108-What-is-DreamObjects-">What is DreamObjects?</a></li>
</ul>
<dl>
<dd><img alt="01_DHO_Panel_Upload.fw.png" class="img-border" src="https://objects-us-east-1.dream.io/kbimages/images/01_DHO_Panel_Upload.fw.png"/></dd>
</dl>
</li>
<li>On the <a class="panel-link" href="https://panel.dreamhost.com/index.cgi?tree=cloud.objects" rel="noopener" target="_blank">DreamObjects</a> page, locate the User that contains the bucket you wish to work with, then click the <strong>View Objects</strong> button.
<dl>
<dd>
<p><em>The available buckets appear in the following window:</em></p>
<div class="figure"><img alt="02_DHO_Panel_Upload.fw.png" src="https://objects-us-east-1.dream.io/kbimages/images/02_DHO_Panel_Upload.fw.png"/></div>
</dd>
</dl>
</li>
<li>Select the bucket you wish to upload objects to.
<dl>
<dd><img class="img-border" src="https://objects-us-east-1.dream.io/kbimages/images/2018-06_panel_dho-add-folder.png"/></dd>
</dl>
</li>
<li>Click the 'Add Folder' link and add a new folder called 'backups'. This folder will be used to upload your website and database backups.</li>
</ol>
<h2>Step 3 — Creating the backup script</h2>
<ol>
<li>Log into your server via <a href="https://help.dreamhost.com/hc/en-us/articles/216041267-SSH-overview">SSH</a>.</li>
<li>Create a new directory named 'backup' in your user's home directory.
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">mkdir ~/backup</span></pre>
</div>
</li>
<li>In this directory, <a href="https://help.dreamhost.com/hc/en-us/articles/115006413028-Creating-and-editing-a-file-via-SSH">create a file</a> named example.com-backup.sh. Make sure to change example.com to the site you're backing up.
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">touch ~/backup/example.com-backup.sh</span></pre>
</div>
</li>
<li>In the script below, you must fill in the first six variables that are highlighted:
<ul>
<li><strong>domains</strong> — The script uses this field to create a directory under $HOME/backups/. This is the directory that will store your database and website files, so make sure it's named the same as your domain name.</li>
<li><strong>sqldbs</strong> — The name of your <a href="https://help.dreamhost.com/hc/en-us/articles/221610868-Finding-your-database-login-credentials">database</a>.</li>
<li><strong>opath</strong> — The directory you want to back up to.</li>
<li><strong>mysqlhost</strong> — Your MySQL database <a href="https://help.dreamhost.com/hc/en-us/articles/221610868-Finding-your-database-login-credentials">hostname</a>.</li>
<li><strong>username</strong> — Your MySQL <a href="https://help.dreamhost.com/hc/en-us/articles/221610868-Finding-your-database-login-credentials">username</a>.</li>
<li><strong>password</strong> — Your MySQL <a href="https://help.dreamhost.com/hc/en-us/articles/221610868-Finding-your-database-login-credentials">password</a>.</li>
<li><strong>webdir </strong>— This is the path to your web directory. Change the domain name to your site.</li>
<li><strong>bucket-name</strong> — The name of the DreamObjects bucket you're backing up to.</li>
<li><strong>example.com-backup.sh</strong> — This is the name of your backup file in your $HOME/backup directory.</li>
</ul>
</li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/115006413028-Creating-and-editing-a-file-via-SSH">Add the following code to this file</a>. Make sure to update any code that's bold.
<div class="preboxcontainer">
<pre class="prebox">domain=( <span class="command">example.com</span> )
sqldb=( <span class="command">your-db-name</span> )
opath=$HOME/<span class="command">backup/</span>
mysqlhost=<span class="command">mysql.example.com</span>
username=<span class="command">db-username</span>
password=<span class="command">db-user-password<br/></span>webdir=$HOME/<span class="command">example.com</span>
today=$(date +%m-%d-%Y)

for (( i = 0; i &lt; ${#domain[@]}; i++))
do
        cpath=$opath${domain[$i]}
        if [ -d $cpath ]
        then
                filler="just some action to prevent syntax error"
        else
                echo Creating $cpath
                mkdir -p $cpath
        fi
        mysqldump -c -h $mysqlhost --user $username --password=$password ${sqldb[$i]} &gt; ${cpath}/"$today"_${sqldb[$i]}.sql
        zip -r ${cpath}/"$today"_"$domain".zip $webdir

done

#use aws-cli to upload to DreamObjects
aws --endpoint-url https://objects-us-east-1.dream.io s3 sync $opath s3://<span class="command">bucket-name</span>/backups/ --exclude "$opath"<span class="command">example.com-backup.sh</span>

#delete backup from web server
find $HOME/backup/* -type d -exec rm -rf {} \; 2&gt; /dev/null</pre>
</div>
</li>
</ol>
<p>The above code backs up your database and website files to your DreamObjects bucket inside a folder named /backups.</p>
<h2>Step 3 — Install aws-cli</h2>
<p>aws-cli is a command line client that allows you to manage your DreamObjects data. To install, you'll need to create a Python virtual environment. In that, you can install aws-cli.</p>
<p>View the following article for instructions on how to install and configure aws-cli for your bucket.</p>
<ul>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/216335908-Installing-and-configuring-AWS-CLI">Installing and configuring AWS CLI</a></li>
</ul>
<h2>Step 4 — Running the file</h2>
<h3>Running it manually</h3>
<p>After activating your virtual environment, you can run the file manually with the following command:</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">(my-user-bucket) </span><span class="command">sh ~/backup/example.com-backup.sh</span></pre>
</div>
<h3>Running it with a cron job</h3>
<p>You can also create a <a href="https://help.dreamhost.com/hc/en-us/articles/215088668-How-do-I-create-a-cron-job-">cron job</a> to run this automatically at specific times. To do this, create a new file named something like 'websitebackup.sh' with the following code.</p>
<div class="alert alert-note">
<div class="alert-icon"><img height="60" src="https://objects-us-east-1.dream.io/kbimages/images/dh-kb-note-icon.svg" width="60"/></div>
<div class="alert-content">
<p>Make sure to change 'my-user-bucket' to the name of your virtual environment, and example.com-backup.sh to the name of your backup file.</p>
</div>
</div>
<div class="preboxcontainer">
<pre class="prebox">#!/bin/bash
source ~/my-user-bucket/bin/activate
sh ~/backup/example.com-backup.sh</pre>
</div>
<p>View the <a href="https://help.dreamhost.com/hc/en-us/articles/215088668-How-do-I-create-a-cron-job-">How do I create a cron job?</a> article to create your cron job. In the text box, enter the following command (change the username to your Shell user).</p>
<p><strong>/bin/bash /home/username/websitebackup.sh</strong></p>
<h2><span id="See_also">See also</span></h2><div class="solvvy-hidden">
<ul>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/215099117-MySQL-overview">MySQL overview</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214395738-phpMyAdmin-How-to-backup-or-export-a-database-or-table">phpMyAdmin — How to backup / export a database or table</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/215100557-How-do-I-restore-my-database-in-the-panel-">How do I restore my database in the panel?</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/215039758-Backing-up-database-overview">Backing up database overview</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214395768-phpMyAdmin-How-to-import-or-restore-a-database-or-table">phpMyAdmin — How to import / restore a database or table</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214395638-phpMyAdmin-overview">phpMyAdmin overview</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214882998-How-do-I-connect-to-my-database-via-SSH-">How do I connect to my database via SSH?</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/216041267-SSH-overview">SSH overview</a></li>
<li><a href="/hc/en-us/articles/221686207-SSH-Backing-up-your-database">SSH — Backing up your database</a></li>
<li><a href="/hc/en-us/articles/217117947-How-do-I-use-a-mysqldump-script-to-back-up-my-database-">How do I use a mysqldump script to back up my database?</a></li>
</ul>
<h3>External links</h3>
<ul>
<li><a href="http://dev.mysql.com/doc/refman/5.0/en/mysqldump.html">MySQL 5.0 Reference Manual: mysqldump</a></li>
</ul></div>
