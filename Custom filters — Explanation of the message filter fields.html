<h2>Overview</h2>
<div class="solvvy-solution">
<p>The following is a list of available fields you can add on the <a class="panel-link" href="https://panel.dreamhost.com/index.cgi?tree=mail.filters&amp;" target="_blank" rel="noopener">Message Filters</a> page in your panel.</p>
<p>View the <a href="https://help.dreamhost.com/hc/en-us/articles/215030678-How-do-I-enable-message-filters-on-my-email-address-">How do I enable message filters on my email address</a> article for further details.</p>
<div class="alert alert-important">
<div class="alert-icon"><img src="https://kbimages.dreamhosters.com/images/dh-kb-important-icon.svg" alt="" width="60" height="60" /></div>
<div class="alert-content">
<p>The following should be taken into consideration when creating filters:</p>
<ul>
<li>Order matters! The rules are checked one by one, so be sure you have them listed in the order you want them to be checked or executed.</li>
<li>Most rules should end with <span class="text-object">execute and stop</span>. Only use <span class="text-object">execute and continue</span> if you wish to do multiple actions to a single incoming email.</li>
</ul>
</div>
</div>
</div>
<h2>How 'execute and stop' functions</h2>
<div class="solvvy-solution">
<p>The 'execute and stop' rule only applies to a rule that performs a delivery action such as moving the email to a folder.</p>
<p>If the rule is set to only add text to the HEADER or Subject, 'execute and stop' will not apply. In this case, the filter will continue to the next rule until it runs a rule with a delivery action. The following examples explain this further.</p>
<table style="border-collapse: collapse; width: 100%;" border="1">
<tbody>
<tr>
<th style="width: 35%;">Rule</th>
<th style="width: 30%;">Result</th>
<th style="width: 35%;">Explanation</th>
</tr>
<tr>
<td>
<p>First, add <strong>FILTERED</strong> to the subject of emails with <strong>testing</strong> in the <strong>subject</strong> and then stop.</p>
<p><br />Finally, move emails with <strong>example.com</strong> in the <strong>from</strong> to <em>filterfolder</em> and then stop.</p>
</td>
<td>
<p>The text FILTERED is added to the subject, but the filter continues to the second rule.</p>
<p>&nbsp;</p>
<p>The email is then moved into the folder.</p>
</td>
<td>Since the first rule did not perform a delivery action, the filter continued on to the second rule which did.</td>
</tr>
<tr>
<td>
<p>First, add <strong>FILTERED</strong> to the subject of emails with <strong>testing</strong> in the <strong>subject</strong> and then stop.</p>
<p><br />Then, move emails with <strong>example.com</strong> in the from to <em>filterfolder</em> and then stop.</p>
<p><br />Finally, add the header <strong>Test-Header:&nbsp;FILTERED</strong> to emails with <strong>*example.com</strong> in the <strong>headers</strong> and then stop.</p>
</td>
<td>
<p>The text FILTERED is added to the subject, but the filter continues to the second rule.</p>
<p>&nbsp;</p>
<p>The email is then moved into the folder.</p>
<p>&nbsp;</p>
<p>The final rule is not applied.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</td>
<td>
<p>Since the first rule did not perform a delivery action, the filter continued on to the second rule.</p>
<p>&nbsp;</p>
<p>Since the second rule performed a delivery action, the filter was executed and stopped.</p>
<p>&nbsp;</p>
<p>The final rule was not executed since the second rule performed the delivery action.</p>
<p>&nbsp;</p>
</td>
</tr>
</tbody>
</table>
</div>
<h2>List of fields to add to your custom filter</h2>
<div class="solvvy-solution"><br />
<table style="border-collapse: collapse; width: 100%;" border="1">
<tbody>
<tr>
<th style="width: 10%;" bgcolor="#F2F2F2">Field</th>
<th style="width: 40%;" bgcolor="#F2F2F2">Explanation</th>
<th style="width: 50%;" bgcolor="#F2F2F2">Example</th>
</tr>
<tr>
<td style="width: 80px; text-align: center;">
<p><strong>Subject</strong></p>
</td>
<td>
<p>Looks in the <span class="text-object">Subject</span> line of the email. It looks everywhere in the subject line, and can match part or all of the Subject.</p>
</td>
<td>
<p>match <span class="text-object">drink</span> in <strong>Subject: Eat, drink, and be merry!</strong></p>
</td>
</tr>
<tr>
<td style="text-align: center; width: 80px;">
<p><strong>From</strong></p>
</td>
<td>Looks in the <span class="text-object">From</span> line of the email, checking for who sent the email. It looks everywhere in the From line, and can match part or all of the From line.</td>
<td>
<p>match <span class="text-object">bob</span> in <strong>From: bob@example.com</strong></p>
<p>match <span class="text-object">Jones</span> in <strong>From: Bob Jones &lt;bob@example.com&gt;</strong></p>
</td>
</tr>
<tr>
<td style="text-align: center; width: 80px;">
<p><strong>To</strong></p>
</td>
<td>Looks in the <span class="text-object">To</span> line of the email, checking for whom the email was sent to. It starts searching directly after <span class="text-object">To</span>. Use <span class="wysiwyg-font-size-large"><strong>*</strong></span> before your term to match any part of the name or email address anywhere in the line.
<p>Tip: Combine this rule with using <span class="wysiwyg-font-size-large"><strong>+</strong></span> for slightly customized email addresses for easy sorting of emails from websites. Give Amazon your email address as <strong>you+amazon@example.com</strong> and then you can easily filter those emails.</p>
</td>
<td>
<p>match <span class="text-object">George</span> in <strong>To: George of the Jungle &lt;george@example.com&gt;</strong></p>
<p>match <span class="text-object">books</span> in <strong>To: me+books@example.com</strong></p>
</td>
</tr>
<tr>
<td style="text-align: center; width: 80px;">
<p><strong>CC</strong></p>
</td>
<td>Looks in the <span class="text-object">CC</span> line(s) of the email, checking for other people the email was sent to.</td>
<td style="text-align: center; width: 398px;">N/A</td>
</tr>
<tr>
<td style="text-align: center; width: 80px;">
<p><strong>Headers</strong></p>
</td>
<td>Looks at the beginning of every line in the email header. Intended for use when matching header lines, such as <span class="text-object">X-Spam: Yes</span>. Note that this only checks the headers. It does not check the message body.
<p>Tip: use <span class="wysiwyg-font-size-large"><strong>*</strong></span> to match anywhere in the line, not just the beginning.</p>
</td>
<td>
<p>match <span class="text-object">X-Spam: Yes</span> in the email's headers</p>
<p>match <span class="text-object">*bananas</span> to match <strong>bananas</strong> anywhere in any line of the header</p>
</td>
</tr>
<tr>
<td style="text-align: center; width: 80px;">
<p><strong>Reply-To</strong></p>
</td>
<td>Looks in the <span class="text-object">Reply-To</span> line of the email for the email address where replies to the email are sent.</td>
<td style="text-align: center; width: 398px;">N/A</td>
</tr>
<tr>
<td style="text-align: center; width: 80px;">
<p><strong>Body</strong></p>
</td>
<td>Looks in the message body of the email and does not look in the headers.</td>
<td style="text-align: center; width: 398px;">N/A</td>
</tr>
</tbody>
</table>
</div>
<p>&nbsp;</p>
<h2><span id="Explanation_of_the_.E2.80.98Do_this.E2.80.99_action_option_fields">Explanation of the 'Do this' action option fields</span></h2>
<div class="solvvy-solution"><br />
<table style="border-collapse: collapse; width: 100%;" border="1">
<tbody>
<tr>
<th style="width: 15%;" bgcolor="#F2F2F2">Field</th>
<th style="width: 40%;" bgcolor="#F2F2F2">Explanation</th>
<th style="width: 55%;" bgcolor="#F2F2F2">Example</th>
</tr>
<tr>
<td>
<p><strong>Move it to folder</strong></p>
</td>
<td>
<p>Puts the email in the specified folder. This is possibly the most useful action, but there are a few caveats/restrictions:</p>
<p>Folder names are cAsE sEnSiTiVe! Double-check your folder name's spelling and <span class="code">Shift</span> key usage.</p>
<p>The filters cannot use folder names that have spaces in the name. Subfolders are okay, but must be specified with the parent folder and a period (e.g. <span class="text-object">ParentFolder.SubFolder</span>). Folder names can only contain only letters, numbers, underscores, dots, and dashes. (But no leading dots, trailing dots, or double dots!)</p>
</td>
<td style="text-align: center;">N/A</td>
</tr>
<tr>
<td style="text-align: center; width: 66px;">
<p><strong>Add this to the subject</strong></p>
</td>
<td>Adds the specified text to the beginning of the email's subject line.</td>
<td>
<p><span class="text-object">Subject: Test Email</span></p>
<p>becomes</p>
<p><span class="text-object">Subject: ADDED_TEXT Test Email</span></p>
</td>
</tr>
<tr>
<td>
<p><strong>Add this header</strong></p>
</td>
<td style="width: 298px;">Adds the specified text to the header area of the email. This added text will not be visible when the email is displayed normally – it will only be visible when viewing all the headers.</td>
<td style="text-align: center; width: 429px;">N/A</td>
</tr>
<tr>
<td style="text-align: center; width: 66px;">
<p><strong>Forward to shell account</strong></p>
</td>
<td>
<p>Forward the email to the <span class="text-object">/Maildir</span> directory of a shell user. This is the same as forwarding to <strong>shell_user@servername.dreamhost.com</strong>. You can control what happens to the email received by the shell user by creating a <strong>.forward.postfix</strong> file in your <a href="https://help.dreamhost.com/hc/en-us/articles/360001219231-Where-is-the-home-directory-#the-users-home-directory" target="_self">user's home directory</a>.</p>
<p><strong>Permissions</strong></p>
<p>The <span class="text-object">.forward.postfix</span> file can have <a href="https://help.dreamhost.com/hc/en-us/articles/214751018-UNIX-commands-Changing-permissions" target="_self">644 permissions</a>.</p>
<p>The file you want to run must have <a href="https://help.dreamhost.com/hc/en-us/articles/214751018-UNIX-commands-Changing-permissions" target="_self">755 permissions</a>.</p>
</td>
<td class="wysiwyg-text-align-left" style="text-align: center; width: 429px;">
<p>These examples show what to put into the <span class="text-object">.forward.postfix</span> file in order to run a file when the email is received. Make sure to change <span class="text-object">username</span> to your <a href="https://help.dreamhost.com/hc/en-us/articles/216385837-Creating-a-user-with-Shell-SSH-access" target="_self">Shell user</a>.</p>
<p>To run a bash script:&nbsp;</p>
<div class="preboxcontainer">
<pre class="prebox">"| /home/<span class="code-highlight">username</span>/myscript.sh"</pre>
</div>
<p>To run a PHP file script:</p>
<div class="preboxcontainer">
<pre class="prebox">"| /usr/local/php74/bin/php /home/<span class="code-highlight">username</span>/myscript.php"</pre>
</div>
</td>
</tr>
<tr>
<td style="text-align: center; width: 66px;">
<p><strong>Delete it</strong></p>
</td>
<td>The email is not put in the <span class="text-object">Trash</span> folder and is completely erased.</td>
<td style="text-align: center; width: 429px;">N/A</td>
</tr>
</tbody>
</table>
</div>
<h2><span id="Doing_more_than_one_action">Doing more than one action</span></h2>
<div class="solvvy-solution">
<p>Each individual message filter can check for multiple things but can only perform a single action. You can use "execute and continue" to have multiple actions done on a single email. When a filter has "execute and continue" the action from the matching filter is taken, and then the next filter is checked and filtering continues. Normally, filters are made with "execute and stop" and the first rule that matches is the only action taken, and no more filters are checked.</p>
<p>Here's an example set of filters that check for spam and also sort mail into folders:</p>
<ul>
<li>add POSSIBLE SPAM to the subject of emails for any of the following:</li>
</ul>
<dl>
<dd>-contains viagra in the Subject</dd>
<dd>-contains diet in the Subject</dd>
<dd>-contains monkey in the Subject</dd>
<dd>and then <strong>continue</strong></dd>
</dl>
<ul>
<li>move emails to Amazon with Amazon in the Subject</li>
</ul>
<dl>
<dd>and then <strong>stop</strong>.</dd>
</dl>
<ul>
<li>move emails to Twitter with twitter.com in the From</li>
</ul>
<dl>
<dd>and then <strong>stop</strong>.</dd>
</dl>
</div>
<h2><span id="Using_message_filters_with_the_Junk_Mail_filters">Using message filters with DreamHost spam&nbsp;filters</span></h2>
<div class="solvvy-solution">
<p>You can still use the message filters even if the domain is set up with MailChannels spam filters. Mail is filtered through the spam machines first, then gets routed to the regular incoming mail machines where your filters are then applied.</p>
</div>
<h2>See also</h2>
<div class="solvvy-hidden">
<ul>
<li><a style="background-color: #ffffff;" href="https://help.dreamhost.com/hc/en-us/articles/215030678-Custom-filters-How-to-enable-message-filters-on-an-email-address">How do I enable message filters on my email address?</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214984738-Anti-spam-overview">Anti-spam overview</a></li>
<li><a href="https://regex101.com/">regex101.com</a>&nbsp;– Regular Expression tester you can use when creating custom message filters in your panel</li>
</ul>
</div>
