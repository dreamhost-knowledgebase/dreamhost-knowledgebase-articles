<h2><span id="Removing_a_hacked_file">Removing a hacked file</span></h2>
<p>Regardless of the mode of the intrusion, you'll want to clean up after a hack to ensure the integrity of your site and to ensure that it cannot be compromised again. To do this, you will need to go through all of the files under the compromised user account and delete anything which you did not place there. If you're using an <a href="/hc/en-us/articles/215613107-List-of-FTP-client-software">FTP client</a>, make sure to <a href="/hc/en-us/articles/215613037-How-do-I-show-hidden-files-on-my-FTP-client-">enable viewing "hidden" files</a> – and the same for shell by using the -a option with <code>ls</code>.</p>
<p>It can sometimes help to first look for files with modification timestamps that occurred since you last modified your site or around the time the hack took place. If you have identified a file that was definitely modified in the hack (such as a defaced index page), you may be able to pinpoint the files used to modify the hacked file by searching for the file's timestamp in your HTTP logs via shell.</p>
<p>A useful command for doing this is:</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">find /home/yourusername/www.example.com/ ! -name "log" -mtime -3</span></pre>
</div>
<p>where the "-3" is the number of days in the past to look for modified files. This command lists all files under /home/user/example.com that have been modified in the past 3 days.</p>
<dl>
<dd></dd>
<dd></dd>
</dl>
<div class="alert alert-note">
<div class="alert-icon"><img src="https://objects-us-west-1.dream.io/kbimages/images/dh-kb-note-icon.svg" alt="" width="60" height="60" /></div>
<div class="alert-content">
<p>If the above command does not work, try without www, for example:</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">find /home/yourusername/example.com/ ! -name "log" -mtime -3</span></pre>
</div>
</div>
</div>
<p>Recent HTTP logs are located in the following directory:</p>
<div class="preboxcontainer">
<pre class="prebox">/home/yourusername/logs/example.com/http/</pre>
</div>
<h2><span id="Cleaning_up_database_hacks">Cleaning up database hacks</span></h2>
<p>Certain hacks, particularly SQL injection attacks against vulnerable Joomla! installations, may result in the database becoming altered with malicious code. Such a modification can allow the hacker back in even if you've updated to the latest version and cleaned off all foreign files. For this reason, it's a good idea after a hack to inspect the database in the same way you check your files to see if anything has been changed that should not have been. If you know when the hack occurred, you may even wish to revert the database back to a prior time via the backup feature available in the panel. View the Backup article for further details.</p>
<h2><span id="Restoring_lost.2Fmodified_files">Restoring lost/modified files</span></h2>
<p>Finally, to restore files that have been modified or deleted in the hack please see the article on <a href="/hc/en-us/articles/215768257-How-do-I-restore-my-website-">restoring your domain</a>. DreamHost offers database and domain restores from the panel, and the sooner you get to them the better as backups are only kept for a few days.</p>
<p>View the <a href="/hc/en-us/articles/215089918-How-do-I-backup-my-entire-account-">Backup</a> article for further details and options.</p>
<h2><span id="Removing_backdoors">Removing backdoors</span></h2>
<p>The main purpose of exploiting insecure websites is to gain and maintain access for the benefit of the hacker. Therefore, after discovering a vulnerability, backdoors are almost always installed so that the hacker can return at a later time. Failure to identify and remove these backdoors will result in your site becoming exploited again.</p>
<p>Common methods or retaining access include:</p>
<ul>
<li><strong>installing a shell</strong> – a file which can be requested like any other page on your site, but gives the requester complete access. These are often written in PHP but can be in any language. They are often given innocent sounding names or contain obfuscated code. They may also be appended to legitimate files with extra code added so that the functionality is only available when an extra parameter is passed to the file during the request.</li>
<li><strong>creating new users</strong> – These may be new database users or web app users.</li>
<li><strong>storing authenticated cookies</strong> – Most apps have the option of remembering who is logged in by storing a cookie on the user's computer. If a hacker manages to modify/create a user and receive an authenticated cookie, then this cookie can often be reused until it expires even if the password for that user is changed. To force holders of authenticated cookies to log in again, the salt used to encrypt the cookies must be changed after passwords have been reset.</li>
<li><strong>changing folder and file permissions to world-writable</strong></li>
<li><strong>adding a public key to .ssh/authorized_keys</strong></li>
</ul>
<p>Unfortunately, there is no single-step, foolproof way of finding and removing backdoors. It takes time and knowledge to investigate the mode of entry and the actions that occurred afterwards. There are many examples on the web of the types of steps that you can take.</p>
<h2>See also</h2>
<ul>
<li><a href="/hc/en-us/categories/202186727">List of website troubleshooting articles</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/215604737-Hacked-sites-overview">Hacked sites overview</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/215605037-Preventing-future-hacks">Preventing future hacks</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214915728-Determining-how-your-site-was-hacked">Determining how your site was hacked</a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/216105097-How-do-I-examine-my-access-log-">How do I examine my access.log? </a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/215458038-Viewing-your-access-log">Viewing your access.log</a></li>
<li><a href="/hc/en-us/articles/115000675027-FTP-overview-and-credentials">FTP overview and credentials</a></li>
</ul>
