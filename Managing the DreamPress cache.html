<div class="alert alert-note">
<div class="alert-icon"><img src="https://kbimages.objects-us-east-1.dream.io/images/dh-kb-note-icon.svg" alt="" width="60" height="60" /></div>
<div class="alert-content">
<p>The following instructions assume you have the latest version of the Proxy Cache Purge plugin. If your WP Admin shows that an update is available for this plugin, please update the plugin if you are having trouble with these steps.</p>
</div>
</div>
<p>Caching on DreamPress is done via a Varnish server. The <a href="http://wordpress.org/plugins/varnish-http-purge/">Varnish HTTP Purge</a> plugin is installed on all new and upgraded DreamPress installations. This plugin automatically flushes the cache when pages or posts are published. <br /><br />If you have copied over an existing WordPress site from another host to DreamPress, installing this plugin is highly recommended so that managing your DreamPress cache is automated and does not require your attention under normal circumstances.</p>
<h2>When would you need to purge your cache?</h2>
<p>You should purge your cache when you make changes to your site such as when you customize or create new content. The new changes may not show, since the old version of your site may be cached. Purging your cache can help to push your changes live so visitors see the most recent version of your site.</p>
<h2><span id="Manually_purging_the_Varnish_cache_via_the_plugin">Manually purging the Varnish cache via the plugin</span></h2>
<p>The Varnish HTTP Purge plugin (included in all DreamPress installs) comes with an <strong>Empty Cache</strong> button. This button can be found in the main dashboard of WordPress, and clicking it will purge the entire cache. <em>USE THIS SPARINGLY</em>. The whole point of caching is to cache.</p>
<p>A better alternative is to selectively purge the cache of a specific item that you changed, if the changes aren’t showing up. You can now purge a post or page from cache using the plugin’s Empty Cache button.</p>
<ol>
<li>Make sure you are logged into your WP Admin.</li>
<li>Load the URL of the page or post you want to purge from cache.</li>
<li>In the WP Admin toolbar at the top of the page, hover over the “Cache” button in the Admin toolbar and select “This Page’s Cache.”
<dl>
<dd><em>The page reloads and the page is purged from cache.</em></dd>
</dl>
</li>
</ol>
<p>If you need to selectively purge specific files such as CSS you manually changed and uploaded via SFTP/SSH, you'll still need to do it via <a class="reference internal" href="#Manually_purging_the_Varnish_cache_via_SSH">SSH</a> for now.</p>
<h2>Temporarily bypassing the Varnish cache</h2>
<p>The Varnish HTTP Purge plugin has a “Development Mode” feature which allows you to temporarily bypass all caching of HTTP requests. This prevents visitors from seeing any cached content on your WordPress site. You might find this useful if your site is still under development or if you are making major changes to the design. In addition, if you are having issues with a theme or plugin, the developer might ask you to try disabling cache to test it further.</p>
<p>You can enable this feature for 24 hours, after which it will automatically disable itself. You can also manually turn off Development Mode before the 24 hours are over, when you are done with your changes or testing. This allows your site to be cached by Varnish again and improves page loading times for your visitors. Development Mode makes your site run slower, so please use with caution.</p>
<p>To disable Varnish caching (activate Development Mode):</p>
<ol>
<li>Open the WordPress Admin dashboard (e.g., 'example.com/wp-admin').
<dl>
<dd><img src="https://objects-us-east-1.dream.io/kbimages/images/2018-06_dreampress_varnish_devmode_03.fw.png" alt="2018-06_dreampress_varnish_devmode_03.fw.png" /></dd>
</dl>
</li>
<li>Navigate to ‘Varnish' &gt; 'Settings’.
<dl>
<dd><em>The Varnish HTTP Purge Settings page opens:</em></dd>
</dl>
<dl>
<dd><img class="img-border" src="https://objects-us-east-1.dream.io/kbimages/images/2018-06_dreampress_varnish_devmode_01.png" alt="2018-06_dreampress_varnish_devmode_01.png" /></dd>
</dl>
</li>
<li>Scroll down to the 'Development Mode Settings' section.</li>
<li>Check the 'Activate Development Mode' checkbox, and then click the blue <strong>Save Settings</strong> button.
<dl>
<dd><em>The following confirmation message appears on the settings page:</em></dd>
</dl>
<dl>
<dd><img class="img-border" src="https://objects-us-east-1.dream.io/kbimages/images/2018-06_dreampress_varnish_devmode_02.png" alt="2018-06_dreampress_varnish_devmode_02.png" /></dd>
</dl>
</li>
</ol>
<p>Varnish HTTP Purge Development Mode remains active for 24 hours, after which it disables and caching resumes normally. You can also manually disable Development Mode on this same page by un-checking the 'Development Mode' box and then clicking the 'Save Settings' button.</p>
<h2><span id="Manually_purging_the_Varnish_cache_via_SSH">Manually purging the Varnish cache via SSH</span></h2>
<p>A Purge is an HTTP request using the method <code>PURGE</code>. In DreamPress, the request URI can be interpreted in several different ways, one of which is as a Perl Compatible Regular Expression (<a href="http://www.pcre.org/">PCRE</a>). If the URL includes characters that look like a PCRE (for example <code>.*</code>), then it will be treated as a PCRE, so be sure to always include <code>.*</code> if your intention is to purge multiple pages. See <a href="https://github.com/dreamhost/varnish-vcl-collection/blob/master/lib/purge.vcl">the DreamHost Varnish config</a> for more details.</p>
<p>The DreamPress Varnish config uses IP-based Access Control Lists (ACLs) so that the purge request <strong>must</strong> come from the DreamPress machine. Purge requests from other IPs will show <code>error 405 Not allowed.</code></p>
<p>To manually purge the Varnish Cache, you must change the DreamPress user to be a <a href="/hc/en-us/articles/216385837-Enabling-Shell-access">shell account</a>, and make use of the <span class="code">curl</span> command-line tool while logged into your domain via <a href="/hc/en-us/articles/216041267-SSH-overview">SSH</a>.</p>
<p>The following is an example command of how to purge a single CSS file:</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">curl -X PURGE "http://example.com/wp-content/themes/mytheme/style\.css"</span></pre>
</div>
<div class="alert alert-note">
<div class="alert-icon"><img src="https://objects-us-east-1.dream.io/kbimages/images/dh-kb-note-icon.svg" alt="" width="60" height="60" /></div>
<div class="alert-content">
<p>If your site is using <em>www</em> or any other subdomain, you <strong>must</strong> use the complete domain name in the purge URL. Make sure the domain part matches <strong>exactly</strong> with what appears when visiting your site.</p>
</div>
</div>
<p>Note that <span class="code">.</span> (dot) and other PCRE metacharacters need to be escaped if they are present in the path. Do not escape <code>.</code> (dot) characters in the domain name.</p>
<p>If you are making changes to your theme files, or updating themes, an easy way to clear all theme files from your cache would be:</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">curl -X PURGE "http://example.com/wp-content/themes/.*" </span></pre>
</div>
<p>You can also target specific types of files using the following syntax:</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">curl -X PURGE "http://example.com/wp-content/themes/.*\.js"</span>
<span class="server">[server]$ </span><span class="command">curl -X PURGE "http://example.com/wp-content/themes/.*\.css" </span></pre>
</div>
<p>If the Varnish HTTP Purge plugin is active, you can run the following command to purge the Varnish cache:</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">wp varnish purge</span></pre>
</div>
<h2>Purging cache manually via SSH with Cloudflare</h2>
<p>If you’re using DreamPress behind a proxy like Cloudflare or another firewall service, you need to run a different command.</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">curl -X PURGE "http://123.45.67.89/wp-content/themes/mytheme/style*" -H "host:www.example.com"</span></pre>
</div>
<p>To find your Varnish IP, go to (<a href="https://panel.dreamhost.com/index.cgi?tree=domain.manage&amp;">Panel &gt; 'Domains' &gt; 'Manage Domains'</a>) and click on the DNS link beneath the domain. The IP address entry for the www or blank A record is your varnish server. For example:</p>
<div class="preboxcontainer">
<pre class="prebox">www A 208.97.157.172</pre>
</div>
<p>If you’ve configured DreamPress properly for Varnish, you can use the wp-cli command:</p>
<div class="preboxcontainer">
<pre class="prebox"><span class="server">[server]$ </span><span class="command">wp varnish purge</span></pre>
</div>
<h2>See also</h2>
<ul>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214581158-DreamPress-overview">DreamPress overview </a></li>
<li><a href="https://help.dreamhost.com/hc/en-us/articles/214581728-DreamPress-FAQs">DreamPress FAQs</a></li>
</ul>
